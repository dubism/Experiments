<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Emoji â†’ Pollinations Image</title>
<style>
  body{margin:0;height:100%;display:grid;place-items:center;
    background:radial-gradient(circle at 30% 30%,#f0faff,#fff0fa,#fafff0);}
  .stage{position:relative;width:min(70vmin,500px);aspect-ratio:1/1;}
  .cauldron{position:relative;width:100%;height:100%;border-radius:50%;
    background:#ffffff66;box-shadow:0 4px 20px #0002,inset 0 2px 6px #fff9;
    overflow:hidden;display:grid;place-items:center;}
  .ring{position:absolute;inset:6%;border:2px dashed #0002;border-radius:50%;}
  .placed{position:absolute;width:64px;height:64px;border-radius:50%;
    display:grid;place-items:center;background:#fff8;
    box-shadow:0 2px 6px #0002;cursor:grab;transform:translate(-50%,-50%);}
  .placed .e{font-size:32px;}
  .image{position:absolute;inset:0;border-radius:50%;background-size:cover;
    background-position:center;opacity:0;transition:.6s ease;}
  .image.revealed{opacity:1;}
  .footer{margin-top:20px;display:flex;gap:12px;justify-content:center}
  .input{min-width:200px;padding:6px 10px;border-radius:10px;border:1px solid #0002}
  .cta{width:60px;height:60px;border-radius:50%;display:grid;place-items:center;
    font-size:26px;cursor:pointer;background:#fff;box-shadow:0 2px 6px #0003;}
</style>
</head>
<body>
  <div>
    <div class="stage">
      <div class="cauldron" id="cauldron">
        <div class="ring"></div>
        <div class="image" id="image"></div>
      </div>
    </div>
    <div class="footer">
      <input class="input" id="freeInput" placeholder="type text or emojiâ€¦"/>
      <button class="cta" id="cta">âœ…âž”</button>
    </div>
  </div>

<script>
const cauldron = document.getElementById('cauldron');
const imageEl = document.getElementById('image');
const cta = document.getElementById('cta');
const freeInput = document.getElementById('freeInput');

let placed = []; // {emoji, x%, y%}

// place some starter emojis
['ðŸ¶','â¤ï¸','ðŸŒˆ'].forEach((emo,i)=>{
  const angle = (i/3)*2*Math.PI;
  const x = 50 + 30*Math.cos(angle);
  const y = 50 + 30*Math.sin(angle);
  addPlaced(emo,x,y);
});

function addPlaced(emoji,x,y){
  const id = Math.random().toString(36).slice(2);
  placed.push({id,emoji,x,y});
  const n = document.createElement('div');
  n.className='placed'; n.dataset.id=id;
  n.style.left=x+'%'; n.style.top=y+'%';
  n.innerHTML=`<span class="e">${emoji}</span>`;
  cauldron.appendChild(n);
}

function buildPrompt(){
  const parts = placed.map(p=>p.emoji);
  const text = freeInput.value.trim();
  return [...parts,text].filter(Boolean).join(' , ');
}

async function callPollinations(prompt){
  const url = "https://image.pollinations.ai/prompt/" +
              encodeURIComponent(prompt) + "?width=768&height=768";
  const res = await fetch(url,{mode:"cors"});
  const blob = await res.blob();
  return URL.createObjectURL(blob);
}

cta.addEventListener('click', async ()=>{
  const prompt = buildPrompt();
  console.log("Prompt â†’",prompt);
  imageEl.classList.remove('revealed');
  imageEl.style.backgroundImage='';
  try{
    const imgURL = await callPollinations(prompt);
    imageEl.style.backgroundImage = `url(${imgURL})`;
    imageEl.classList.add('revealed');
  }catch(e){ console.error(e); }
});
</script>
</body>
</html>