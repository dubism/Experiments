<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>RGB String-Dots — camera mapping (fixed)</title>
<style>
  :root{ --bg:#000; --ink:#fff; --muted:#a6b0bf; --line:rgba(255,255,255,.14); --panel:rgba(16,18,24,.78); }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);overflow:hidden;font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  canvas{display:block;width:100vw;height:100vh;touch-action:none;}

  /* Control Center (CC) */
  .cc{
    position:fixed; left:10px; right:10px; bottom:10px; z-index:3;
    background:var(--panel); border:1px solid var(--line); border-radius:14px;
    backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
    box-shadow:0 8px 24px rgba(0,0,0,.35);
  }
  .cc__head{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; cursor:pointer; }
  .cc__title{ font-weight:650; letter-spacing:.2px; }
  .cc__chev{ width:22px; height:22px; border-radius:999px; display:grid; place-items:center; border:1px solid var(--line); background:rgba(255,255,255,.06); }
  .cc__body{ padding:6px 12px 10px; display:grid; gap:10px; grid-template-columns:1fr; }
  .ctrl{
    display:grid; grid-template-columns:auto 1fr auto; gap:8px; align-items:center;
    background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);
    border-radius:10px; padding:8px 10px;
  }
  .ctrl--withbtn{ grid-template-columns:auto 1fr auto auto; }
  .ctrl__label{ color:#d6deea; font-size:12px; white-space:nowrap; }
  .ctrl__val{ color:#cfd7e3; font-size:12px; min-width:42px; text-align:right; }
  .ctrl input[type=range]{ width:100%; }
  .btn{
    appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.08); color:#e8eef7;
    padding:6px 10px; border-radius:9px; cursor:pointer; font-weight:600; font-size:12px;
  }
  .btn.ok{ background:rgba(57,217,138,.14); border-color:rgba(57,217,138,.4) }
  .btn.err{ background:rgba(255,107,107,.14); border-color:rgba(255,107,107,.4) }
  .meter{ position:relative; height:6px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden; grid-column:1 / -1; }
  .meter__fill{ position:absolute; left:0; top:0; bottom:0; width:0%; background:#9bd2ff; }

  .cc[data-collapsed="true"] .cc__body{ display:none; }
  .cc[data-collapsed="true"] .cc__chev{ transform:rotate(180deg); }

  @media (min-width:520px){
    .cc__body{ grid-template-columns:1fr 1fr; }
    .ctrl{ grid-column:span 1; }
    .ctrl.span2{ grid-column:span 2; }
  }

  /* hidden video/canvas for camera sampling */
  video.cam, canvas.cam { position:fixed; inset:-9999px auto auto -9999px; width:1px; height:1px; opacity:0; pointer-events:none; }
</style>
</head>
<body>
  <canvas id="cv"></canvas>

  <section class="cc" id="cc" data-collapsed="false">
    <div class="cc__head" id="ccHead">
      <div class="cc__title">Controls</div><div class="cc__chev" aria-hidden="true">▾</div>
    </div>
    <div class="cc__body">
      <!-- Defaults (per your screenshot) -->
      <div class="ctrl"><div class="ctrl__label">Looseness</div><input id="loose" type="range" min="0" max="100" value="20"><div id="looseV" class="ctrl__val">20</div></div>
      <div class="ctrl"><div class="ctrl__label">Bounce</div>   <input id="bounce" type="range" min="0" max="100" value="20"><div id="bounceV" class="ctrl__val">20</div></div>
      <div class="ctrl"><div class="ctrl__label">Grid</div>     <input id="space"  type="range" min="12" max="60" value="25"><div id="spaceV"  class="ctrl__val">25</div></div>
      <div class="ctrl"><div class="ctrl__label">Dot</div>      <input id="dot"    type="range" min="1"  max="10" value="7"><div  id="dotV"    class="ctrl__val">7</div></div>

      <div class="ctrl ctrl--withbtn span2">
        <div class="ctrl__label">Motion sensitivity</div>
        <input id="motionSens" type="range" min="0" max="100" value="50" step="1">
        <div id="motionSensV" class="ctrl__val">0.50</div>
        <button class="btn" id="motionBtn" type="button">Motion</button>
      </div>

      <div class="ctrl ctrl--withbtn span2">
        <div class="ctrl__label">Sound sensitivity</div>
        <input id="soundSens" type="range" min="0" max="100" value="35" step="1">
        <div id="soundSensV" class="ctrl__val">0.35</div>
        <button class="btn" id="micBtn" type="button">Mic</button>
      </div>

      <div class="ctrl ctrl--withbtn span2">
        <div class="ctrl__label">Camera sensitivity</div>
        <input id="camSens" type="range" min="0" max="100" value="60" step="1">
        <div id="camSensV" class="ctrl__val">0.60</div>
        <button class="btn" id="camBtn" type="button">Camera</button>
      </div>

      <div class="ctrl"><div class="ctrl__label">Touch sensitivity</div><input id="touchSens" type="range" min="0" max="100" value="70"><div id="touchSensV" class="ctrl__val">0.70</div></div>
      <div class="ctrl"><div class="ctrl__label">Touch radius</div><input id="touchRad" type="range" min="10" max="100" value="45"><div id="touchRadV" class="ctrl__val">0.45</div></div>

      <div class="meter span2" aria-hidden="true"><div class="meter__fill" id="meterFill"></div></div>
    </div>
  </section>

  <!-- hidden camera elements -->
  <video id="camVideo" class="cam" playsinline muted autoplay></video>
  <canvas id="camCanvas" class="cam"></canvas>

<script>
(() => {
  // ===== Canvas =====
  const cvs = document.getElementById('cv');
  const ctx  = cvs.getContext('2d', { alpha:false });
  let dpr = Math.max(1, window.devicePixelRatio || 1);
  let needsLayout = false;

  function resize(){
    const r = cvs.getBoundingClientRect();
    cvs.width  = Math.floor(r.width  * dpr);
    cvs.height = Math.floor(r.height * dpr);
    needsLayout = true;
  }
  addEventListener('resize', resize, { passive:true });
  resize();

  // ===== CC collapse =====
  const cc = document.getElementById('cc');
  document.getElementById('ccHead').addEventListener('click', function(){
    cc.dataset.collapsed = (cc.dataset.collapsed === 'true') ? 'false' : 'true';
  });

  // ===== UI =====
  const ui = {
    loose:  document.getElementById('loose'),
    bounce: document.getElementById('bounce'),
    space:  document.getElementById('space'),
    dot:    document.getElementById('dot'),
    looseV: document.getElementById('looseV'),
    bounceV:document.getElementById('bounceV'),
    spaceV: document.getElementById('spaceV'),
    dotV:   document.getElementById('dotV'),
    motionSens: document.getElementById('motionSens'),
    soundSens:  document.getElementById('soundSens'),
    motionSensV:document.getElementById('motionSensV'),
    soundSensV: document.getElementById('soundSensV'),
    touchSens:  document.getElementById('touchSens'),
    touchRad:   document.getElementById('touchRad'),
    touchSensV: document.getElementById('touchSensV'),
    touchRadV:  document.getElementById('touchRadV'),
    camSens:    document.getElementById('camSens'),
    camSensV:   document.getElementById('camSensV'),
    micBtn:     document.getElementById('micBtn'),
    motionBtn:  document.getElementById('motionBtn'),
    camBtn:     document.getElementById('camBtn'),
    meterFill:  document.getElementById('meterFill'),
  };

  function syncVals(){
    ui.looseV.textContent   = ui.loose.value;
    ui.bounceV.textContent  = ui.bounce.value;
    ui.spaceV.textContent   = ui.space.value;
    ui.dotV.textContent     = ui.dot.value;
    ui.motionSensV.textContent = (Number(ui.motionSens.value)/100).toFixed(2);
    ui.soundSensV