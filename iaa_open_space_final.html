<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IAA Open Space 2025 â€” Map & Guide</title>
<style>
  :root{
    --bg:#0b0c0e; --card:#101217; --ring:#1c1f25;
    --text:#e6e9ef; --sub:#a5adba; --muted:#8b95a1;
    --accent:#9bffd0; --accent-text:#042d22;
    --shadow:0 10px 40px rgba(0,0,0,.35)
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:#9fd5ff;text-decoration:none} a:hover{text-decoration:underline}
  h1{margin:20px 16px 6px;font-size:clamp(28px,6vw,44px);line-height:1.05}
  p.lead{margin:0 16px 16px;color:var(--sub)}
  .wrap{max-width:980px;margin:0 auto;padding:0 12px}
  header{position:static;background:linear-gradient(180deg,rgba(11,12,14,.98),rgba(11,12,14,.6));border-bottom:1px solid var(--ring)}
  .search{display:block;width:100%;margin:12px auto 18px;padding:14px 16px;border-radius:14px;background:#0d0f12;border:1px solid var(--ring);color:var(--text);outline:none}

  /* MAP */
  .map-shell{position:relative}
  .map{position:sticky;top:0;z-index:5;border:1px solid var(--ring);border-radius:18px;overflow:hidden;background:#0e1115;box-shadow:var(--shadow);height:46vh}
  .map.shrink{height:40vh}
  .map-inner{position:absolute;inset:0;transform:translate(0,0);transition:transform .55s cubic-bezier(.2,.7,.2,1)}
  .map img{display:block;width:100%;height:auto}
  /* Pins are absolutely positioned by % relative to the IMAGE; they sit inside .map-inner alongside the img */
  .pin{position:absolute;width:18px;height:18px;border-radius:50%;border:2px solid #fff;background:var(--muted);color:#fff;font-size:11px;line-height:14px;text-align:center;transform:translate(-50%,-50%);opacity:.55;transition:transform .2s ease,opacity .2s ease,background-color .2s ease,box-shadow .2s ease}
  .pin.active{background:var(--accent);color:var(--accent-text);opacity:1;box-shadow:0 0 0 4px rgba(155,255,208,.25);z-index:2;transform:translate(-50%,-50%) scale(1.15)}
  .legend{display:flex;flex-wrap:wrap;gap:10px 16px;color:var(--sub);padding:10px 6px 0}
  .legend .b{display:inline-grid;grid-auto-flow:column;align-items:center;gap:6px}
  .legend .dot{display:inline-grid;place-items:center;width:18px;height:18px;border-radius:50%;border:2px solid #fff;background:var(--muted);color:#fff;font-size:10px;line-height:10px}
  .legend .dot.active{background:var(--accent);color:var(--accent-text)}

  /* FOCUS LINE (invisible; toggle .debug-focus on body to show) */
  .focus-line{position:fixed;left:0;right:0;top:38vh;height:0;pointer-events:none;z-index:9}
  body.debug-focus .focus-line::after{content:"";position:absolute;left:0;right:0;top:0;height:2px;background:rgba(155,255,208,.5)}

  /* CARDS */
  .cluster{margin:18px 0;border:1px solid var(--ring);border-radius:18px;background:var(--card);overflow:hidden}
  .cluster>summary{cursor:pointer;list-style:none;padding:16px 18px;font-weight:700}
  .cluster>summary::-webkit-details-marker{display:none}
  .grid{display:grid;gap:12px;padding:0 12px 14px}
  .card{border:1px solid var(--ring);border-radius:16px;padding:16px;background:#0f1216}
  .brand{font-weight:800;font-size:26px;margin:2px 0 2px}
  .topic{color:var(--sub);margin:0 0 12px}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--ring);border-radius:999px;padding:10px 14px;background:#0c0f13;color:var(--text);text-decoration:none}
  .btn::after{content:"â†—";font-size:14px}
  .pin-no{display:inline-grid;place-items:center;width:18px;height:18px;border-radius:50%;border:2px solid #fff;background:var(--muted);color:#fff;font-size:11px;font-weight:800}
  .card.active .pin-no{background:var(--accent);color:var(--accent-text)}
  small.meta{display:block;margin-top:10px;color:var(--sub)}
  @media (max-width:640px){.brand{font-size:22px}}
</style>
</head>
<body>
<div class="focus-line" aria-hidden="true"></div>

<header class="wrap">
  <h1>IAA Open Space 2025 â€” Map & Guide</h1>
  <p class="lead">City venues and brand cards. Map sticks; the card nearest the focus line controls the highlight.</p>
  <input id="q" class="search" placeholder="Filter by brand, location, countryâ€¦">
</header>

<main class="wrap map-shell">
  <!-- Map -->
  <section id="map" class="map" aria-label="City map with venue pins">
    <div id="mapInner" class="map-inner">
      <img id="mapImg" alt="Munich city center map"
           src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Munich_City_Center.svg/1024px-Munich_City_Center.svg.png">
      <!-- Pins (left/top = % of image). These do NOT change between full/cropped states -->
      <div class="pin" data-id="1" style="left:8.33%;top:33.64%">1</div>   <!-- KÃ¶nigsplatz -->
      <div class="pin" data-id="2" style="left:18.59%;top:76.73%">2</div>  <!-- Lenbachplatz 7a -->
      <div class="pin" data-id="3" style="left:71.18%;top:59.18%">3</div>  <!-- Wittelsbacherplatz -->
      <div class="pin" data-id="4" style="left:78.00%;top:63.00%">4</div>  <!-- Odeonsplatz -->
      <div class="pin" data-id="5" style="left:74.00%;top:57.00%">5</div>  <!-- Lucid Studio (Odeonsplatz 2) -->
      <div class="pin" data-id="6" style="left:87.49%;top:71.07%">6</div>  <!-- Residenz / Brunnenhof -->
      <div class="pin" data-id="7" style="left:89.68%;top:19.14%">7</div>  <!-- LudwigstraÃŸe -->
      <div class="pin" data-id="8" style="left:80.04%;top:91.67%">8</div>  <!-- Max-Joseph-Platz -->
      <div class="pin" data-id="9" style="left:11.00%;top:82.00%">9</div>  <!-- Isarpost -->
    </div>
  </section>
  <div class="legend" aria-hidden="true">
    <span class="b"><span class="dot">1</span> KÃ¶nigsplatz</span>
    <span class="b"><span class="dot">2</span> Lenbachplatz&nbsp;7a</span>
    <span class="b"><span class="dot">3</span> Wittelsbacherplatz</span>
    <span class="b"><span class="dot">4</span> Odeonsplatz</span>
    <span class="b"><span class="dot">5</span> Lucid Studio</span>
    <span class="b"><span class="dot">6</span> Residenz / Brunnenhof</span>
    <span class="b"><span class="dot">7</span> LudwigstraÃŸe</span>
    <span class="b"><span class="dot">8</span> Max-Joseph-Platz</span>
    <span class="b"><span class="dot">9</span> Isarpost</span>
  </div>

  <!-- Cards (sample set). Attach data-pin with one or more IDs -->
  <details class="cluster" open>
    <summary>ðŸ‡©ðŸ‡ª German brands</summary>
    <div class="grid" id="cards">
      <article class="card" data-brand="Audi" data-pin="3">
        <div class="brand">Audi</div>
        <p class="topic">Open Space brand presence.</p>
        <a class="btn" href="https://www.google.com/maps?q=Wittelsbacherplatz,+80333+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">3</span> Wittelsbacherplatz
        </a>
        <small class="meta">Status: Confirmed â€” Confidence: High</small>
      </article>

      <article class="card" data-brand="BMW" data-pin="8">
        <div class="brand">BMW</div>
        <p class="topic">World premiere & program.</p>
        <a class="btn" href="https://www.google.com/maps?q=Max-Joseph-Platz,+80539+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">8</span> Max-Joseph-Platz
        </a>
        <small class="meta">Status: Confirmed â€” Confidence: High</small>
      </article>

      <article class="card" data-brand="MINI" data-pin="8,2">
        <div class="brand">MINI</div>
        <p class="topic">Open Space + MINI Pavilion.</p>
        <a class="btn" href="https://www.google.com/maps?q=Max-Joseph-Platz,+80539+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">8</span> Max-Joseph-Platz
        </a>
        <a class="btn" href="https://www.google.com/maps?q=Lenbachplatz+7a,+80333+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">2</span> Lenbachplatz&nbsp;7a
        </a>
        <small class="meta">Status: Confirmed â€” Confidence: High</small>
      </article>

      <article class="card" data-brand="Mercedes-Benz" data-pin="6">
        <div class="brand">Mercedes-Benz</div>
        <p class="topic">Residenz courtyards program.</p>
        <a class="btn" href="https://www.google.com/maps?q=Apothekenhof,+Residenz+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">6</span> Residenz / Apothekenhof
        </a>
        <small class="meta">Status: Program â€” Confidence: High</small>
      </article>

      <article class="card" data-brand="smart" data-pin="4">
        <div class="brand">smart</div>
        <p class="topic">Public display.</p>
        <a class="btn" href="https://www.google.com/maps?q=Odeonsplatz,+80539+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">4</span> Odeonsplatz
        </a>
        <small class="meta">Status: Confirmed â€” Confidence: Mid-High</small>
      </article>

      <article class="card" data-brand="Lucid" data-pin="6,5">
        <div class="brand">Lucid</div>
        <p class="topic">EU launch; Open Space booth & Studio.</p>
        <a class="btn" href="https://www.google.com/maps?q=Brunnenhof,+Residenz+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">6</span> Brunnenhof (Residenz)
        </a>
        <a class="btn" href="https://www.google.com/maps?q=Odeonsplatz+2,+80539+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">5</span> Lucid Studio (Odeonsplatz&nbsp;2)
        </a>
        <small class="meta">Status: Confirmed â€” Confidence: High</small>
      </article>

      <article class="card" data-brand="Å koda" data-pin="9">
        <div class="brand">Å koda</div>
        <p class="topic">Vision O; Isarpost (public Sept 9 only).</p>
        <a class="btn" href="https://www.google.com/maps?q=Isarpost,+Sonnenstra%C3%9Fe+24-26,+80331+M%C3%BCnchen" target="_blank" rel="noopener">
          <span class="pin-no">9</span> Isarpost, SonnenstraÃŸe 24â€“26
        </a>
        <small class="meta">Status: Premiere â€” Confidence: High</small>
      </article>
    </div>
  </details>
</main>

<script>
/* ===== helpers ===== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/* ===== search ===== */
const q = $('#q');
q.addEventListener('input', ()=>{
  const t = q.value.trim().toLowerCase();
  $$('#cards .card').forEach(c=>{
    const hay = (c.dataset.brand + ' ' + c.textContent).toLowerCase();
    c.style.display = hay.includes(t) ? '' : 'none';
  });
  // after filtering, recompute focus
  requestAnimationFrame(syncActiveFromFocus);
});

/* ===== map + focus logic ===== */
const map = $('#map');
const inner = $('#mapInner');
const img = $('#mapImg');
const pins = $$('#map .pin');
const dots = $$('.legend .dot');
const cards = $$('#cards .card');

function getPinEl(id){ return pins.find(p=>p.dataset.id===String(id)); }

function highlightPins(ids){
  pins.forEach(p=>p.classList.remove('active'));
  dots.forEach(d=>d.classList.remove('active'));
  ids.forEach(id=>{
    const p = getPinEl(id); if(p) p.classList.add('active');
    const d = dots.find(x=>x.textContent.trim()===String(id)); if(d) d.classList.add('active');
  });
}

function panMapToPins(ids){
  // Only pan when cropped; in full-height state keep origin.
  const shrunk = map.classList.contains('shrink');
  if(!shrunk){ inner.style.transform = 'translate(0px,0px)'; return; }

  // Use the IMAGE rect (not container) so % pin coords remain correct.
  const rImg = img.getBoundingClientRect();
  const rView = map.getBoundingClientRect();
  let sx=0, sy=0, n=0;
  ids.forEach(id=>{
    const p = getPinEl(id); if(!p) return;
    const left = parseFloat(p.style.left)/100, top=parseFloat(p.style.top)/100;
    sx += left * rImg.width; sy += top * rImg.height; n++;
  });
  if(!n){ inner.style.transform='translate(0px,0px)'; return; }
  const cx = sx/n, cy = sy/n;

  let tx = rView.width/2  - cx;
  let ty = rView.height/2 - cy;

  // Clamp to image bounds so we never show empty space.
  const minX = rView.width  - rImg.width;
  const minY = rView.height - rImg.height;
  tx = Math.min(0, Math.max(minX, tx));
  ty = Math.min(0, Math.max(minY, ty));
  inner.style.transform = `translate(${tx}px,${ty}px)`;
}

let activeCard = null;
function activate(card){
  if(!card || card===activeCard) return;
  cards.forEach(c=>c.classList.toggle('active', c===card));
  activeCard = card;
  const ids = (card.dataset.pin||'').split(',').map(s=>s.trim()).filter(Boolean);
  highlightPins(ids);
  panMapToPins(ids);
}

// Pick card nearest to focus line (~38% of viewport)
function cardNearestFocus(){
  const focusY = window.innerHeight * 0.38;
  let best=null, bestDist=1e9;
  cards.forEach(c=>{
    if(c.style.display==='none') return;
    const r = c.getBoundingClientRect();
    if(r.bottom<=0 || r.top>=window.innerHeight) return;
    const mid = r.top + r.height/2;
    const d = Math.abs(mid - focusY);
    if(d < bestDist){ best=c; bestDist=d; }
  });
  return best;
}

function syncActiveFromFocus(){
  // Toggle shrink state
  const r = map.getBoundingClientRect();
  map.classList.toggle('shrink', r.top<=0);

  const c = cardNearestFocus();
  if(c) activate(c);
}

window.addEventListener('scroll', ()=>requestAnimationFrame(syncActiveFromFocus), {passive:true});
window.addEventListener('resize', ()=>requestAnimationFrame(()=> {
  if(activeCard){
    const ids = (activeCard.dataset.pin||'').split(',').map(s=>s.trim()).filter(Boolean);
    panMapToPins(ids);
  }
}));

window.addEventListener('load', ()=>{
  // First highlight
  syncActiveFromFocus();
});
</script>
</body>
</html>