async function copyFile(path, btn){
  const original = btn.innerHTML;
  const pagesUrl = `${BASE}${path}`;
  const apiUrl = `https://api.github.com/repos/${USER}/${REPO}/contents/${encodePath(path)}?ref=HEAD`;

  btn.disabled = true; btn.innerHTML = 'Copying…';
  try{
    // 1) Same-origin (avoids CORS + API limits)
    let r = await fetch(pagesUrl, {cache:'no-store'});
    if(r.ok){ await writeToClipboard(await r.text()); btn.innerHTML='Copied ✓'; return; }

    // 2) Contents API (base64, untruncated)
    r = await fetch(apiUrl, { headers:{'Accept':'application/vnd.github+json'} });
    if(r.ok){
      const data = await r.json();
      if(data?.encoding === 'base64'){
        const bin = Uint8Array.from(atob(data.content.replace(/\n/g,'')), c=>c.charCodeAt(0));
        const text = new TextDecoder('utf-8').decode(bin);
        await writeToClipboard(text); btn.innerHTML='Copied ✓'; return;
      }
      if(data?.download_url){
        const r2 = await fetch(data.download_url, {cache:'no-store'});
        if(r2.ok){ await writeToClipboard(await r2.text()); btn.innerHTML='Copied ✓'; return; }
      }
    }

    // 3) Last resort: try Pages again (maybe transient)
    const r3 = await fetch(pagesUrl, {cache:'reload'});
    if(r3.ok){ await writeToClipboard(await r3.text()); btn.innerHTML='Copied ✓'; return; }

    throw new Error('All fetches failed');
  }catch(e){
    console.error(e); btn.innerHTML = 'Failed ✕';
  }finally{
    setTimeout(()=>{ btn.disabled=false; btn.innerHTML=original; }, 1200);
  }
}