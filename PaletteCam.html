<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Edge-to-Edge Square Camera Â· Leftover UI</title>
<style>
  /* ===== Base reset ===== */
  html,body{height:100%}
  body{margin:0;background:#000;color:#fff;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}

  /* ===== Layout: one source of truth for square side ===== */
  :root{ --sq:0px; }

  .app{
    position:fixed; inset:0;
    display:grid;
  }

  /* Portrait: camera on top as a square band; UI below uses remainder */
  @media (orientation: portrait){
    .app{ grid-template-rows: var(--sq) 1fr; grid-template-columns: 1fr; }
    #videoPane{ grid-row:1; grid-column:1; }
    #uiPane   { grid-row:2; grid-column:1; min-height:0; overflow:auto; }
  }

  /* Landscape: camera on left as a full-height square; UI on the right uses remainder */
  @media (orientation: landscape){
    .app{ grid-template-columns: var(--sq) 1fr; grid-template-rows: 1fr; }
    #videoPane{ grid-column:1; grid-row:1; }
    #uiPane   { grid-column:2; grid-row:1; min-width:0; overflow:auto; }
  }

  /* Camera cell */
  #videoPane{
    position:relative;
    overflow:hidden;           /* crop to perfect square */
    background:#000;
  }
  /* Make media fill the square edge-to-edge without gaps */
  #videoPane video,
  #videoPane canvas{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover;          /* critical: no letterboxing */
    transform:translateZ(0);   /* helps some GPUs on iOS */
    background:#000;
  }

  /* UI cell; pad for safe areas only here (camera stays flush) */
  #uiPane{ box-sizing:border-box; padding:12px; }
  @supports (padding: env(safe-area-inset-bottom)){
    #uiPane{ padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
  }

  /* --- Demo-only styling (safe to remove) --- */
  .demoCard{
    border:1px solid #222; border-radius:10px; padding:12px; background:#0a0a0a;
    margin:0 0 12px 0;
  }
  .muted{color:#bdbdbd}
  button{background:#111;border:1px solid #222;border-radius:10px;color:#fff;padding:10px 14px}
</style>
</head>
<body>
  <div class="app">
    <!-- Camera square (left in landscape, top in portrait) -->
    <section id="videoPane" aria-label="Camera">
      <video id="cam" autoplay playsinline muted></video>
      <!-- If you draw overlays, put a <canvas> here sized to the cell -->
    </section>

    <!-- Everything else in your UI goes here; it will only use leftover space -->
    <section id="uiPane" aria-label="UI">
      <!-- Demo content; replace with your existing UI -->
      <div class="demoCard">
        <strong>UI area (leftover space)</strong>
        <div class="muted">Sized automatically from what remains after the square camera is placed.</div>
      </div>
      <button id="toggle">Demo action</button>
    </section>
  </div>

<script>
/* ===== Robust sizing: compute --sq from visualViewport ===== */
(function(){
  const root = document.documentElement;
  const vv = window.visualViewport;

  function computeSq(){
    // Use visualViewport when available for iOS URL bar correctness
    const vw = Math.max(0, window.innerWidth);
    const vh = Math.max(0, (vv?.height ?? window.innerHeight));

    const isLandscape = vw > vh;
    // Square side: full viewport height in landscape; min(vw, vh) in portrait
    const sq = isLandscape ? vh : Math.min(vw, vh);

    root.style.setProperty('--sq', Math.round(sq) + 'px');

    // If you have a canvas overlay in #videoPane, resize it here to match the cell:
    // const cv = document.querySelector('#videoPane canvas');
    // if (cv) { cv.width = cv.clientWidth; cv.height = cv.clientHeight; }
  }

  let raf = 0;
  const kick = () => { cancelAnimationFrame(raf); raf = requestAnimationFrame(computeSq); };

  // Run on initial paint and on viewport changes
  window.addEventListener('load', kick, {passive:true});
  window.addEventListener('resize', kick, {passive:true});
  window.addEventListener('orientationchange', kick, {passive:true});
  window.addEventListener('pageshow', kick, {passive:true}); // bfcache restore
  vv && vv.addEventListener('resize', kick, {passive:true});
})();

/* ===== Minimal camera bootstrap (no gating) ===== */
(async function startCamera(){
  const video = document.getElementById('cam');
  try{
    // Prefer environment camera; no audio
    const constraints = { video: { facingMode: { ideal: 'environment' } }, audio: false };
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;
    await video.play(); // ensure autoplay begins
  }catch(err){
    console.error('Camera error:', err);
    // Optional: unobtrusive error UI
    const msg = document.createElement('div');
    msg.textContent = 'Camera unavailable. Check permissions.';
    msg.style.cssText = 'position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:#bbb';
    document.getElementById('videoPane').appendChild(msg);
  }
})();

/* ===== Demo-only: quick first sizing pass ===== */
document.addEventListener('DOMContentLoaded', ()=> {
  // Force one sizing pass immediately for quick correctness
  const evt = document.createEvent('Event'); evt.initEvent('resize', true, true); window.dispatchEvent(evt);
});
</script>
</body>
</html>