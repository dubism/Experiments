// 1) Views — remove "neutral background" so env/time can show
const views = [
  "Front three-quarter product view — camera at headlamp height; vehicle yaw ~30° toward camera; wheels straight; centered; ~85% frame coverage.",
  "Side profile product view — left side; camera level at mid-door; perpendicular 90°; wheels straight; full length edge-to-edge; minimal perspective.",
  "Front head-on product view — camera on centerline at badge height; straight frontal view; wheels straight; strict symmetry; ~80% vertical coverage.",
  "Top-down product view — camera 90° overhead; car centered; full roofline and outline visible; equal margins on all sides."
];

// 2) Strong time tokens (prime + lighting)
function timeTokens(h){
  if (h>=4 && h<6)  return {prime:"pre-dawn blue hour",
    lighting:"cool indigo ambience, faint orange horizon glow, long soft shadows"};
  if (h>=6 && h<8)  return {prime:"sunrise golden hour",
    lighting:"warm golden sunlight, amber rim light, gentle morning mist"};
  if (h>=8 && h<12) return {prime:"morning daylight",
    lighting:"neutral-white sunlight, pale sky, crisp short shadows"};
  if (h===12)       return {prime:"noon",
    lighting:"bright white sun overhead, high contrast, very short shadows"};
  if (h>12 && h<17) return {prime:"afternoon",
    lighting:"warm sunlight with light yellow tint, gradually softening shadows"};
  if (h>=17 && h<20)return {prime:"sunset golden hour",
    lighting:"golden-orange sunlight, long deep shadows, glowing sky band"};
  if (h>=20 && h<22)return {prime:"twilight blue hour",
    lighting:"cobalt-blue ambient glow, first stars visible"};
  if (h>=22 || h<2) return {prime:"night",
    lighting:"silvery moonlight, deep navy sky, stars visible"};
  return {prime:"late night",
    lighting:"sparse lighting, inky sky, subdued reflections"};
}

// 3) Prompts — put time FIRST; keep your lead + era/view/paint unchanged otherwise
function buildPromptLong(){
  const envIdx = +envEl.value;
  const env   = habitats[envIdx];
  const car   = cars[+carEl.value];
  const era   = eras[+eraEl.value];
  const view  = views[+dirEl.value];
  const color = (paints[+paintEl.value].name || paints[+paintEl.value].label).toLowerCase();
  const t     = timeTokens(+timeEl.value);
  const eraTxt= eraCue(era);

  return [
    // simple scene primer you already wanted
    sceneLead(color, envIdx),
    // move time to the front with canonical tokens
    `Time of day: ${t.prime}; ${t.lighting}.`,
    // then the rest of your structure
    `A realistic photo of a ${car} in ${env}.`,
    `Era: ${eraTxt}.`,
    `Catalog view: ${view}`,
    `Car paint finished in ${color}; body paint in ${color}; overall body color ${color}.`,
    `Photorealistic, high detail, no text`
  ].join(' ');
}

function buildPromptShort(){
  const envIdx=+envEl.value;
  const env   = habitats[envIdx];
  const car   = cars[+carEl.value];
  const era   = eras[+eraEl.value];
  const color = (paints[+paintEl.value].name || paints[+paintEl.value].label).toLowerCase();
  const view  = ["front 3/4","side profile","front head-on straight","top-down"][+dirEl.value] || "front 3/4";
  const t     = timeTokens(+timeEl.value);

  return [
    sceneLead(color, envIdx),
    `Time of day: ${t.prime}; ${t.lighting}.`,
    `Photo of a ${car} in ${env}.`,
    `Era: ${eraCueShort(era)}.`,
    `View: ${view}.`,
    `Car paint ${color}; body paint ${color}.`,
    `Photorealistic, high detail, no text`
  ].join(' ');
}